(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-2145","chunk-6067"],{"1lRx":function(t,e,o){"use strict";o.r(e);var r=o("QbLZ"),s=o.n(r),i=o("L2JU"),n=o("oC8U"),a=o("BJ7B"),l={data:function(){return{form:{productType:0,fullAmountType:0,timeType:3,limitType:1},useProList:[],useIds:[],unUserProList:[],unUseIds:[],commodityIds:[],commodityShow:!1,loading:!1,customerShow:!1,customerIds:[],customerList:[]}},created:function(){this.form.couponType=1,this.form.shopId=this.shop.shopId,this.$route.query.couponId&&this.getData()},methods:{getData:function(){var t=this;Object(a.e)(this.$route.query.couponId).then(function(e){if(console.log("优惠券详情",e),200==e.code){var o=e.data;if(1==e.data.productType){t.useProList=e.data.couponProducts;var r=[];t.useProList.forEach(function(t){return r.push(t.productId)}),o.productIds=r,t.useIds=r}if(2==e.data.productType){t.unUserProList=e.data.couponProducts;var s=[];t.unUserProList.forEach(function(t){return s.push(t.productId)}),o.productIds=s,t.unUseIds=s}0==e.data.fullAmount?(console.log("门槛1"),o.fullAmountType=0):(console.log("门槛2"),o.fullAmountType=1,o.fullAmountNum=o.fullAmount),o.timeType=3,o.beginTime="",o.endTime="",o.time=[],o.limitTime1=void 0,o.limitTime2=void 0,t.customerList=e.data.couponUsers,t.customerList.forEach(function(e){return t.customerIds.push(e.userId)}),o.limitType=1,o.limitNumber=o.limitNumber,t.form=o}})},onSubmit:function(){var t=this;if(console.log("form",this.form),this.form.couponName){if(1==this.form.productType){if(0==this.useIds.length)return void this.$message.error("请添加指定可用的商品");this.form.productIds=this.useIds}if(2==this.form.productType){if(0==this.unUseIds.length)return void this.$message.error("请添加指定不可用的商品");this.form.productIds=this.unUseIds}if(0==this.form.fullAmountType&&(this.form.fullAmount=0),1==this.form.fullAmountType){if(!this.form.fullAmountNum)return void this.$message.error("请输入使用门槛金额");this.form.fullAmount=this.form.fullAmountNum}if(this.form.discountAmount){if(0==this.form.timeType){if(0==this.form.time.length)return void this.$message.error("请选择指定日期");this.form.beginTime=this.form.time[0],this.form.endTime=this.form.time[1]}if(1==this.form.timeType){if(!this.form.limitTime1)return void this.$message.error("请输入当日天数, 1 < 天数 < 30");this.form.limitTime=this.form.limitTime1}if(2==this.form.timeType){if(!this.form.limitTime2)return void this.$message.error("请输入次日天数, 1 < 天数 < 30");this.form.limitTime=this.form.limitTime2}0==this.form.limitType&&(this.form.limitNumber=0),1!=this.form.limitType||this.form.limitNumber?(this.loading=!0,console.log("验证成功",this.form),Object(a.a)(this.form).then(function(e){console.log("新增优惠券",e),200==e.code?(t.$message({message:"保存成功",type:"success"}),t.$router.replace({path:"/marketManage/coupon"}),setTimeout(function(){t.loading=!1},1e3)):(t.$message.error(e.message),t.loading=!1)})):this.$message.error("请请输入限领次数, 1 < 次数 < 10")}else this.$message.error("请输入优惠金额，优惠券面值必须大于等于 0元的正整数, 且最大不能超过10000元")}else this.$message.error("请输入优惠券名称")},customerClose:function(){this.customerShow=!1},customerFun:function(t){var e=this;console.log("父接受kehu ",t),t.forEach(function(t){e.customerIds.push(t.userId),e.customerList.push(t)}),this.customerShow=!1},deleteCus:function(t){this.customerList.splice(t,1),this.customerIds.splice(t,1)},addCom:function(t){1==t&&(this.commodityIds=this.useIds),2==t&&(this.commodityIds=this.unUseIds),this.commodityShow=!0},commodityClose:function(){this.commodityShow=!1},commodityFun:function(t){var e=this;console.log("父级接受商品组件回调",t),1==this.form.productType&&(console.log("可用商品"),t.forEach(function(t){e.useIds.push(t.productId),e.useProList.push(t)})),2==this.form.productType&&(console.log("不可用商品"),t.forEach(function(t){e.unUseIds.push(t.productId),e.unUserProList.push(t)})),this.commodityShow=!1},deletePro:function(t,e){console.log("index",e),1==t&&(this.useProList.splice(e,1),this.useIds.splice(e,1)),2==t&&(this.unUserProList.splice(e,1),this.unUseIds.splice(e,1))}},computed:s()({},Object(i.c)(["user","shop"])),components:{commodity:n.default}},u=(o("gfV5"),o("KHd+")),c=Object(u.a)(l,function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"pageContent"},[o("el-form",{ref:"form",attrs:{model:t.form,"label-width":"160px"}},[o("el-card",{staticClass:"filter-container",attrs:{shadow:"never"}},[o("div",{staticClass:"pageHead"},[t._v("基本信息")]),t._v(" "),o("el-form-item",{attrs:{label:"优惠券名称：",required:""}},[o("el-input",{staticStyle:{width:"400px"},attrs:{maxlength:"10","show-word-limit":"",placeholder:"如：年货节优惠券，最多10个字"},model:{value:t.form.couponName,callback:function(e){t.$set(t.form,"couponName",e)},expression:"form.couponName"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"适用商品：",required:""}},[o("el-radio-group",{model:{value:t.form.productType,callback:function(e){t.$set(t.form,"productType",e)},expression:"form.productType"}},[o("el-radio",{attrs:{label:0}},[t._v("全部商品可用")]),t._v(" "),o("el-radio",{attrs:{label:1}},[t._v("指定商品可用")]),t._v(" "),o("el-radio",{attrs:{label:2}},[t._v("指定商品不可用")])],1),t._v(" "),o("div",{staticClass:"infoFont"},[t._v("若活动商品中存在分销商品，优惠后可能造成利润受损")])],1),t._v(" "),1==t.form.productType?o("el-form-item",{attrs:{label:"选择商品：",required:""}},[o("div",[o("el-button",{on:{click:function(e){t.addCom(1)}}},[t._v("添加商品")])],1),t._v(" "),t.useProList.length>0?o("div",{staticClass:"mt10"},[o("el-table",{staticStyle:{width:"100%"},attrs:{data:t.useProList}},[o("el-table-column",{attrs:{label:"商品图片",width:"140"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-popover",{attrs:{placement:"right",title:"",trigger:"hover"}},[o("el-image",{staticStyle:{"max-height":"40px","max-width":"40px"},attrs:{slot:"reference",src:e.row.imageUrl,alt:e.row.imageUrl},slot:"reference"}),t._v(" "),o("el-image",{staticStyle:{"max-height":"350px","max-width":"350px"},attrs:{src:e.row.imageUrl}})],1)]}}])}),t._v(" "),o("el-table-column",{attrs:{label:"商品名称",prop:"productName"}}),t._v(" "),o("el-table-column",{attrs:{label:"可用库存",width:"140",prop:"stock"}}),t._v(" "),o("el-table-column",{attrs:{label:"商品售价（元）",width:"240"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s("￥"+e.row.minPrice+" ~ ￥"+e.row.maxPrice))]}}])}),t._v(" "),o("el-table-column",{attrs:{label:"操作",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-button",{attrs:{type:"text",size:"small"},on:{click:function(o){t.deletePro(1,e.$index)}}},[t._v("删除")])]}}])})],1)],1):t._e()]):t._e(),t._v(" "),2==t.form.productType?o("el-form-item",{attrs:{label:"选择商品：",required:""}},[o("div",[o("el-button",{on:{click:function(e){t.addCom(2)}}},[t._v("添加商品")])],1),t._v(" "),t.unUserProList.length>0?o("div",{staticClass:"mt10"},[o("el-table",{staticStyle:{width:"100%"},attrs:{data:t.unUserProList}},[o("el-table-column",{attrs:{label:"商品图片",width:"140"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-popover",{attrs:{placement:"right",title:"",trigger:"hover"}},[o("el-image",{staticStyle:{"max-height":"40px","max-width":"40px"},attrs:{slot:"reference",src:e.row.imageUrl,alt:e.row.imageUrl},slot:"reference"}),t._v(" "),o("el-image",{staticStyle:{"max-height":"350px","max-width":"350px"},attrs:{src:e.row.imageUrl}})],1)]}}])}),t._v(" "),o("el-table-column",{attrs:{label:"商品名称",prop:"productName"}}),t._v(" "),o("el-table-column",{attrs:{label:"可用库存",width:"140",prop:"stock"}}),t._v(" "),o("el-table-column",{attrs:{label:"商品售价（元）",width:"240"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s("￥"+e.row.minPrice+" ~ ￥"+e.row.maxPrice))]}}])}),t._v(" "),o("el-table-column",{attrs:{label:"操作",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-button",{attrs:{type:"text",size:"small"},on:{click:function(o){t.deletePro(2,e.$index)}}},[t._v("删除")])]}}])})],1)],1):t._e()]):t._e(),t._v(" "),o("el-form-item",{attrs:{label:"使用门槛：",required:""}},[o("el-radio-group",{model:{value:t.form.fullAmountType,callback:function(e){t.$set(t.form,"fullAmountType",e)},expression:"form.fullAmountType"}},[o("el-radio",{attrs:{label:0}},[t._v("无门槛使用")]),t._v(" "),o("el-radio",{attrs:{label:1}},[t._v("订单满\n            "),o("el-input-number",{attrs:{precision:2,max:1e4,controls:!1},model:{value:t.form.fullAmountNum,callback:function(e){t.$set(t.form,"fullAmountNum",e)},expression:"form.fullAmountNum"}}),t._v("\n          元")],1)],1)],1),t._v(" "),o("el-form-item",{attrs:{label:"优惠内容：",required:""}},[t._v("\n        减免\n        "),o("el-input-number",{attrs:{"step-strictly":"",max:1e4,controls:!1},model:{value:t.form.discountAmount,callback:function(e){t.$set(t.form,"discountAmount",e)},expression:"form.discountAmount"}}),t._v("\n        元\n        "),o("div",{staticClass:"infoFont"},[t._v("优惠券面值必须大于等于 0元的正整数, 且最大不能超过10000元")])],1),t._v(" "),o("el-form-item",{attrs:{label:"用券时间：",required:""}},[o("el-radio-group",{model:{value:t.form.timeType,callback:function(e){t.$set(t.form,"timeType",e)},expression:"form.timeType"}},[o("el-radio",{attrs:{label:3}},[t._v("\n            不限制\n            "),o("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"选择不限制，该优惠券不会过期（除非操作人手动失效该优惠券）",placement:"top"}},[o("i",{staticClass:"el-icon-question curP"})])],1),t._v(" "),o("el-radio",{attrs:{label:1}},[t._v("\n            领券当日起\n            "),o("el-input-number",{attrs:{precision:2,max:30,min:1,controls:!1},model:{value:t.form.limitTime1,callback:function(e){t.$set(t.form,"limitTime1",e)},expression:"form.limitTime1"}}),t._v("\n            天内可用\n            "),o("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"发放券当日起N天内可用， 若用户未使用该优惠，则该优惠券为已过期优惠券",placement:"top"}},[o("i",{staticClass:"el-icon-question curP"})])],1)],1)],1)],1),t._v(" "),o("el-card",{staticClass:"filter-container mt10",attrs:{shadow:"never"}},[o("div",{staticClass:"pageHead"},[t._v("领取及使用规则")]),t._v(" "),o("el-form-item",{attrs:{label:"每人限领次数：",required:""}},[o("el-radio-group",{model:{value:t.form.limitType,callback:function(e){t.$set(t.form,"limitType",e)},expression:"form.limitType"}},[o("el-radio",{attrs:{label:1}},[t._v("每人限领\n            "),o("el-input-number",{attrs:{"step-strictly":"",max:10,placeholder:"限领次数上限为10",controls:!1},model:{value:t.form.limitNumber,callback:function(e){t.$set(t.form,"limitNumber",e)},expression:"form.limitNumber"}}),t._v("\n            次\n          ")],1)],1)],1)],1),t._v(" "),o("el-form-item",{staticClass:"mt20 flex-row-center"},[o("el-button",{attrs:{type:"primary",loading:t.loading},on:{click:t.onSubmit}},[t._v("保 存")])],1)],1),t._v(" "),o("commodity",{attrs:{commodityShow:t.commodityShow,commodityIds:t.commodityIds},on:{commodityClose:t.commodityClose,commodityFun:t.commodityFun}})],1)},[],!1,null,"44730c84",null);c.options.__file="newMemberCoupon.vue";e.default=c.exports},BJ7B:function(t,e,o){"use strict";o.d(e,"g",function(){return s}),o.d(e,"j",function(){return i}),o.d(e,"k",function(){return n}),o.d(e,"a",function(){return a}),o.d(e,"d",function(){return l}),o.d(e,"b",function(){return u}),o.d(e,"e",function(){return c}),o.d(e,"c",function(){return m}),o.d(e,"l",function(){return d}),o.d(e,"i",function(){return p}),o.d(e,"h",function(){return f}),o.d(e,"f",function(){return h});var r=o("t3Un");function s(t){return Object(r.a)({url:"/sys/couponInfo/getCouponInfoPage",method:"post",data:t})}function i(t){return Object(r.a)({url:"/sys/couponProduct/getCouponProductPage",method:"post",data:t})}function n(t){return Object(r.a)({url:"/sys/couponProduct/getCouponUserPage",method:"post",data:t})}function a(t){return Object(r.a)({url:"/sys/couponInfo/addCouponInfo",method:"post",data:t})}function l(t){return Object(r.a)({url:"/sys/couponInfo/editCouponInfo",method:"post",data:t})}function u(t){return Object(r.a)({url:"/sys/couponInfo/couponData?couponId="+t,method:"get"})}function c(t){return Object(r.a)({url:"/sys/couponInfo/findCouponInfo?couponId="+t,method:"get"})}function m(t){return Object(r.a)({url:"/sys/couponInfo/deleteCouponInfo?couponId="+t,method:"DELETE"})}function d(t){return Object(r.a)({url:"/sys/couponProduct/userCouponProductPage",method:"post",data:t})}function p(t){return Object(r.a)({url:"/sys/couponInfo/getCouponInfoSubGroupPage",method:"post",data:t})}function f(t){return Object(r.a)({url:"/sys/couponInfo/getCouponInfoSubGroupInfo?couponIdStr="+t,method:"get"})}function h(t){return Object(r.a)({url:"/sys/couponInfo/getCouponCodeUrl?shopId="+t.shopId+"&couponId="+t.couponId,method:"get"})}},GlJz:function(t,e,o){},PRgn:function(t,e,o){"use strict";o.d(e,"b",function(){return s}),o.d(e,"e",function(){return i}),o.d(e,"a",function(){return n}),o.d(e,"f",function(){return a}),o.d(e,"h",function(){return l}),o.d(e,"g",function(){return u}),o.d(e,"d",function(){return c}),o.d(e,"c",function(){return m});var r=o("t3Un");function s(t){return Object(r.a)({url:"/product/business/productCategoryShop/getProductCategoryInfoList",method:"post",data:t})}function i(t){return Object(r.a)({url:"/product/business/productCategoryShop/insertProductCategoryShop",method:"post",data:t})}function n(t){return Object(r.a)({url:"/product/business/productCategoryShop/deleteProductCategoryShop",method:"post",data:t})}function a(t){return Object(r.a)({url:"/product/business/productCategoryShop/isCategoryNameExist?name="+t.name+"&level="+t.level+"&shopId="+t.shopId+"&parentId="+t.parentId,method:"get"})}function l(t){return Object(r.a)({url:"/product/business/productCategoryShop/updateProductCategoryShopOrderNo",method:"post",data:t})}function u(t){return Object(r.a)({url:"/product/business/productCategoryShop/updateProductCategoryShop",method:"post",data:t})}function c(t){return Object(r.a)({url:"/product/business/productCategoryShop/getProductCategoryShopAllList?shopId="+t,method:"get"})}function m(t){return Object(r.a)({url:"/product/business/productCategoryShop/getProductCategoryInfoPageList",method:"post",data:t})}},gfV5:function(t,e,o){"use strict";var r=o("GlJz");o.n(r).a},oC8U:function(t,e,o){"use strict";o.r(e);var r=o("QbLZ"),s=o.n(r),i=o("L2JU"),n=o("PRgn"),a=o("BJ7B"),l={props:["commodityIds","commodityShow"],watch:{commodityShow:function(t,e){t&&this.getData()}},data:function(){return{fromLoading:!1,searchList:{shopCategoryIdArr:[],pageNum:1,pageSize:5},category:[],list:[],listTotal:0,multipleSelection:[]}},created:function(){this.searchList.shopId=this.shop.shopId},methods:{sub:function(){console.log("multipleSelection",this.multipleSelection),0!=this.multipleSelection.length?(this.$emit("commodityFun",this.multipleSelection),this.$refs.multipleTable.clearSelection()):this.$message.error("请选择商品后再试")},toggleSelection:function(t){var e=this;t?t.forEach(function(t){e.$refs.multipleTable.toggleRowSelection(t)}):this.$refs.multipleTable.clearSelection()},handleSelectionChange:function(t){this.multipleSelection=t},handleSizeChange:function(t){console.log("每页 "+t+" 条"),this.searchList.pageSize=t,this.getData()},handleCurrentChange:function(t){console.log("当前页: "+t),this.searchList.pageNum=t,this.getData()},reset:function(){this.searchList.productName="",this.searchList.shopCategoryIdArr=[],this.getData()},getData:function(){var t=this;this.fromLoading=!0,this.searchList.productIds=this.commodityIds||"",this.searchList.shopCategoryPid=this.searchList.shopCategoryIdArr[0]||"",this.searchList.shopCategoryId=this.searchList.shopCategoryIdArr[1]||"",console.log("请求的数据",this.searchList),Object(a.j)(this.searchList).then(function(e){console.log("可添加优惠券的商品列表",e),200==e.code&&(t.list=e.data.list,t.listTotal=e.data.total,t.getCategory()),t.fromLoading=!1})},getCategory:function(){var t=this;Object(n.d)(this.shop.shopId).then(function(e){console.log("获取店铺分类",e),t.category=e.data})},close:function(){this.$emit("commodityClose",!0)},change:function(){this.$forceUpdate()}},computed:s()({},Object(i.c)(["user","shop"]))},u=o("KHd+"),c=Object(u.a)(l,function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-dialog",{attrs:{"append-to-body":!0,title:"新增商品列表",visible:t.commodityShow,width:"70%","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},on:{"update:visible":function(e){t.commodityShow=e}}},[o("el-card",{staticClass:"filter-container",attrs:{shadow:"never"}},[o("div",[o("i",{staticClass:"el-icon-search"}),t._v(" "),o("span",[t._v("筛选搜索")]),t._v(" "),o("el-button",{staticStyle:{float:"right"},attrs:{type:"primary",size:"small"},on:{click:t.getData}},[t._v("查询")]),t._v(" "),o("el-button",{staticStyle:{float:"right","margin-right":"15px"},attrs:{size:"small"},on:{click:t.reset}},[t._v("重置")])],1),t._v(" "),o("div",{staticStyle:{"margin-top":"15px"}},[o("el-form",{attrs:{inline:!0,model:t.searchList,size:"small","label-width":"140px"}},[o("el-form-item",{attrs:{label:"商品名称："}},[o("el-input",{staticStyle:{width:"203px"},attrs:{clearable:"",placeholder:"商品名称"},on:{input:function(e){t.change(e)}},model:{value:t.searchList.productName,callback:function(e){t.$set(t.searchList,"productName",e)},expression:"searchList.productName"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"商品类目："}},[o("el-cascader",{attrs:{options:t.category,props:{checkStrictly:!0},clearable:""},model:{value:t.searchList.shopCategoryIdArr,callback:function(e){t.$set(t.searchList,"shopCategoryIdArr",e)},expression:"searchList.shopCategoryIdArr"}})],1)],1)],1)]),t._v(" "),o("el-card",{staticClass:"filter-container",staticStyle:{"margin-top":"10px"},attrs:{shadow:"never"}},[o("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:t.list,"tooltip-effect":"dark"},on:{"selection-change":t.handleSelectionChange}},[o("el-table-column",{attrs:{type:"selection",width:"55"}}),t._v(" "),o("el-table-column",{attrs:{label:"商品图片",width:"140"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-popover",{attrs:{placement:"right",title:"",trigger:"hover"}},[o("el-image",{staticStyle:{"max-height":"40px","max-width":"40px"},attrs:{slot:"reference",src:e.row.imageUrl,alt:e.row.imageUrl},slot:"reference"}),t._v(" "),o("el-image",{staticStyle:{"max-height":"350px","max-width":"350px"},attrs:{src:e.row.imageUrl}})],1)]}}])}),t._v(" "),o("el-table-column",{attrs:{label:"商品名称",prop:"productName"}}),t._v(" "),o("el-table-column",{attrs:{label:"可用库存",width:"140",prop:"stock"}}),t._v(" "),o("el-table-column",{attrs:{label:"商品售价（元）",width:"240"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s("￥"+e.row.minPrice+" ~ ￥"+e.row.maxPrice))]}}])}),t._v(" "),o("el-table-column",{attrs:{label:"已参与活动",prop:"activeName"}})],1),t._v(" "),o("div",{staticStyle:{padding:"10px 0 20px 0"}},[o("el-pagination",{attrs:{"page-sizes":[5,10,15,20],"page-size":t.searchList.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.listTotal},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:t.close}},[t._v("取 消")]),t._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:t.sub}},[t._v("确 定")])],1)],1)},[],!1,null,null,null);c.options.__file="commodity.vue";e.default=c.exports}}]);
//# sourceMappingURL=chunk-2145.941262c9.js.map